-- تحميل OrionLib
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/jensonhirst/Orion/main/source"))()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Config = { TouchFling = false }
local SelectedPlayer = nil

-- منع السقوط
local function PreventFallDamage()
	local char = LocalPlayer.Character
	if not char then return end
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if humanoid then
		humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding, false)
	end
	for _, v in ipairs(char:GetChildren()) do
		if v:IsA("Script") and v.Name:lower():find("fall") then
			v:Destroy()
		end
	end
end

task.spawn(function()
	while true do
		task.wait(1)
		pcall(PreventFallDamage)
	end
end)

-- إنشاء الواجهة
local Window = OrionLib:MakeWindow({
	Name = "Fling Script | OrionLib",
	HidePremium = false,
	SaveConfig = false,
	ConfigFolder = "FlingScript"
})

local Tab = Window:MakeTab({
	Name = "Fling",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

-- وظيفة Touch Fling
local function TouchFlingFunction()
	PreventFallDamage()
	local y = 0.1
	while Config.TouchFling do
		RunService.Heartbeat:Wait()
		local char = LocalPlayer.Character
		local humanoid = char and char:FindFirstChild("Humanoid")
		local hrp = char and char:FindFirstChild("HumanoidRootPart")

		if hrp then
			if humanoid then
				humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
				humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
				humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding, false)
			end
			local originalVel = hrp.Velocity
			hrp.Velocity = originalVel * 10000 + Vector3.new(0, 10000, 0)
			RunService.RenderStepped:Wait()
			hrp.Velocity = originalVel
			RunService.Stepped:Wait()
			hrp.Velocity = originalVel + Vector3.new(0, y, 0)
			y = -y
		end
	end
end

-- زر Touch Fling
Tab:AddToggle({
	Name = "تفعيل Touch Fling (عند اللمس)",
	Default = false,
	Callback = function(Value)
		Config.TouchFling = Value
		if Value then
			task.spawn(TouchFlingFunction)
		end
	end
})

-- قائمة اختيار اللاعب
Tab:AddDropdown({
	Name = "اختر لاعب للفرنق",
	Default = nil,
	Options = (function()
		local list = {}
		for _, v in ipairs(Players:GetPlayers()) do
			if v ~= LocalPlayer then
				table.insert(list, v.Name)
			end
		end
		return list
	end)(),
	Callback = function(value)
		SelectedPlayer = value
	end
})

-- وظيفة FlingPlayer مع ذكاء لمنع الطيران الزائد
local function FlingPlayer(playerName)
	PreventFallDamage()
	local target = Players:FindFirstChild(playerName)
	if not target or not target.Character then return end

	local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
	local char = LocalPlayer.Character
	local humanoid = char and char:FindFirstChild("Humanoid")
	local hrp = char and char:FindFirstChild("HumanoidRootPart")

	if not targetHRP or not hrp then return end

	local originalCFrame = hrp.CFrame
	local endTime = tick() + 3.5
	local toggle = 0.1
	local lastPos = targetHRP.Position

	while tick() < endTime do
		if humanoid then
			humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
			humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
			humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding, false)
		end
		if not targetHRP or not targetHRP.Parent then break end

		local distance = (targetHRP.Position - lastPos).Magnitude
		if distance > 60 then
			warn("الهدف طار بعيدًا، تم إيقاف Fling!")
			break
		end

		lastPos = targetHRP.Position
		local originalVel = hrp.Velocity
		hrp.CFrame = targetHRP.CFrame + Vector3.new(0, 0.5, 0)
		hrp.Velocity = originalVel * 10000 + Vector3.new(0, 10000, 0)
		RunService.RenderStepped:Wait()
		hrp.Velocity = originalVel
		RunService.Stepped:Wait()
		hrp.Velocity = originalVel + Vector3.new(0, toggle, 0)
		toggle = -toggle
		RunService.Heartbeat:Wait()
	end

	task.wait(0.1)
	hrp.CFrame = originalCFrame

	local BG = Instance.new("BodyGyro")
	local BV = Instance.new("BodyVelocity")

	BG.P = 9e4
	BG.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
	BG.CFrame = hrp.CFrame
	BG.Parent = hrp

	BV.Velocity = Vector3.new(0, 0, 0)
	BV.MaxForce = Vector3.new(9e9, 9e9, 9e9)
	BV.Parent = hrp

	task.delay(0.5, function()
		BG:Destroy()
		BV:Destroy()
	end)
end

-- زر تنفيذ Fling
Tab:AddButton({
	Name = "Fling اللاعب المحدد",
	Callback = function()
		if SelectedPlayer then
			FlingPlayer(SelectedPlayer)
		end
	end
})
